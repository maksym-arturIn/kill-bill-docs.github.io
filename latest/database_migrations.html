<!DOCTYPE html><html lang="en"><head><title>Kill Bill Database Migrations</title><style>pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f8f8f8; }
pre.pygments .tok-c { color: #3D7B7B; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #FF0000 } /* Error */
pre.pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666666 } /* Operator */
pre.pygments .tok-ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #9C6500 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gr { color: #E40000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #008400 } /* Generic.Inserted */
pre.pygments .tok-go { color: #717171 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
pre.pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #B00040 } /* Keyword.Type */
pre.pygments .tok-m { color: #666666 } /* Literal.Number */
pre.pygments .tok-s { color: #BA2121 } /* Literal.String */
pre.pygments .tok-na { color: #687822 } /* Name.Attribute */
pre.pygments .tok-nb { color: #008000 } /* Name.Builtin */
pre.pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #880000 } /* Name.Constant */
pre.pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
pre.pygments .tok-ni { color: #717171; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #0000FF } /* Name.Function */
pre.pygments .tok-nl { color: #767600 } /* Name.Label */
pre.pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #19177C } /* Name.Variable */
pre.pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
pre.pygments .tok-se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #A45A77 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */</style><link rel="icon" type="image/x-icon" href="/stylesheets/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><link rel="preconnect" href="https://S2ISXITURI-dsn.algolia.net"><link rel="stylesheet" href='https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css'><link rel="stylesheet" href='https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.css'><link rel="stylesheet" href="stylesheets/kb.css"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Kill Bill Database Migrations"></head><body data-spy="scroll" data-target="#myScrollspy" data-offset="100"><div class="loader-wrapper"><div id="loading"></div></div><header class="header sticky" id="header"><div class="header-wrapper"><div class="container-fluid"><div class="row flex-xl-nowrap justify-content-evenly"><div class="header-logo"><div class="logo"><a href="/"><img src="/stylesheets/images/logo/light-logo.svg" style="height:38px" alt="Kill Bill Docs" id="logo" height="38" width="146"></a></div><div class="switch"><input type="checkbox" aria-label="Search" name="theme-toggle" id="theme-toggle"><span class="slider round"></span></div></div><div class="nav-toggler sidebar-toggler"><svg class="hamburger" xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 7C20.75 7.41421 20.4142 7.75 20 7.75L4 7.75C3.58579 7.75 3.25 7.41421 3.25 7C3.25 6.58579 3.58579 6.25 4 6.25L20 6.25C20.4142 6.25 20.75 6.58579 20.75 7Z" fill=""/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 12C20.75 12.4142 20.4142 12.75 20 12.75L4 12.75C3.58579 12.75 3.25 12.4142 3.25 12C3.25 11.5858 3.58579 11.25 4 11.25L20 11.25C20.4142 11.25 20.75 11.5858 20.75 12Z" fill=""/><path fill-rule="evenodd" clip-rule="evenodd" d="M20.75 17C20.75 17.4142 20.4142 17.75 20 17.75L4 17.75C3.58579 17.75 3.25 17.4142 3.25 17C3.25 16.5858 3.58579 16.25 4 16.25L20 16.25C20.4142 16.25 20.75 16.5858 20.75 17Z" fill=""/></svg></div><div class="header-search"><div class="search-form-wrapper"><div id="docsearch" style="height: 43px; display: flex; align-items: center; width: 100%;"></div></div></div></div></div></div></header><main class="main sidebar-show"><div class="container-fluid"><div class="row flex-xl-nowrap"><div class="sidebar-wrapper"><aside class="sidebar"><div class="sidebar__control"><svg width="8" height="12" viewBox="0 0 8 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.33316 10.6665L1.6665 5.99992L6.33316 1.33325" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div><nav class="sidebar-nav"><ul class="nav navbar-nav"><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Getting Started</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li><a class="nav-link" href="/latest/what_is_kill_bill.html">What is Kill Bill?</a></li><li><a class="nav-link" href="/latest/getting_started.html">Getting Started (Installation)</a></li><li><a class="nav-link" href="/latest/quick_start_with_kaui.html">Quick Start with Kaui</a></li><li><a class="nav-link" href="/latest/quick_start_with_kb_api.html">Quick Start with the Kill Bill API</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Installation</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/stripe_plugin.html">Kill Bill + Stripe DIY</a></li><li><a class="nav-link" href="/latest/userguide_deployment.html">Going to Production</a></li><li><a class="nav-link" href="/latest/database_migrations.html">Database Migrations</a></li><li><a class="nav-link" href="/latest/PostgreSQL.html">PostgreSQL Setup</a></li><li><a class="nav-link" href="https://github.com/killbill/killbill/releases" onclick="getOutboundLink('https://github.com/killbill/killbill/releases'); return false;">Release&nbsp;Notes</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">AWS</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-set-up-a-single-tier-system.html">Single-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-multi-tier-system.html">Multi-Tier Setup</a></li><li><a class="nav-link" href="/latest/how-to-set-up-a-cloud-formation-system.html">CloudFormation Setup</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/how-to-maintain-a-single-tier-system.html">Single-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-multi-tier-system.html">Multi-Tier Maintenance</a></li><li><a class="nav-link" href="/latest/how-to-maintain-a-cloud-formation-system.html">CloudFormation Maintenance</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Manuals</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/userguide_subscription.html">Subscription&nbsp;Billing</a></li><li><a class="nav-link" href="/latest/userguide_payment.html">Payment Processing</a></li><li><a class="nav-link" href="/latest/userguide_kaui.html">Kaui, the Administrative&nbsp;UI</a></li><li><a class="nav-link" href="/latest/email-notification-plugin.html">Email Notification Plugin</a></li><li><a class="nav-link" href="/latest/custom-email-invoice-formatter.html">Custom Email Formatter</a></li><li><a class="nav-link" href="/latest/userguide_analytics.html">Analytics Plugin</a></li><li><a class="nav-link" href="/latest/userguide_configuration.html">Kill Bill&nbsp;Configuration</a></li><li><a class="nav-link" href="/latest/internationalization.html">Kill Bill&nbsp;Internationalization</a></li><li><a class="nav-link" href="/latest/migration_guide.html">Migrating to Kill Bill</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Tutorials</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plan_alignment.html">Plans Alignments</a></li><li><a class="nav-link" href="/latest/overdue.html">Overdue System</a></li><li><a class="nav-link" href="/latest/consumable_in_arrear.html">In Arrear UsageBilling</a></li><li><a class="nav-link" href="/latest/ha.html">Hierarchical Accounts</a></li><li><a class="nav-link" href="/latest/catalog-examples.html">Catalog Examples</a></li><li><a class="nav-link" href="/latest/invoice_examples.html">Invoice Examples</a></li><li><a class="nav-link" href="/latest/invoice_templates.html">Invoice Templates</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Integration</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="http://killbill.github.io/slate" onclick="getOutboundLink('http://killbill.github.io/slate'); return false;">REST API Reference</a></li><li><a class="nav-link" href="/latest/swagger_documentation.html">Swagger UI Documentation</a></li><li><a class="nav-link" href="/latest/postman.html">Postman Integration</a></li><li><a class="nav-link" href="/latest/debugging.html">Debugging</a></li><li><a class="nav-link" href="/latest/push_notifications.html">Push Notifications</a></li><li><a class="nav-link" href="/latest/kill_bill_events.html">Kill Bill Events</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Plugin Development</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_introduction.html">Plugin Introduction</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_development.html">Plugin Development</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/plugin_installation.html">Plugin Installation</a></li><li><a class="nav-link" href="/latest/plugin_use_cases.html">Special Plugin Use Cases</a></li><li><a class="nav-link" href="/latest/notification_plugin.html">Notification Plugins</a></li><li><a class="nav-link" href="/latest/payment_plugin.html">Payment Plugins</a></li><li><a class="nav-link" href="/latest/payment_control_plugin.html">Payment Control Plugins</a></li><li><a class="nav-link" href="/latest/invoice_plugin.html">Invoice Plugins</a></li><li><a class="nav-link" href="/latest/catalog_plugin.html">Catalog Plugins</a></li><li><a class="nav-link" href="/latest/entitlement_plugin.html">Entitlement Plugins</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Operational Guides</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/deploy_to_kubernetes.html">Kubernetes (K8s) Deployment</a></li><li class="bd-sidenav-active"><a class="nav-link" href="/latest/user_management.html">Users, Roles, and Permissions</a></li><li><a class="nav-link" href="/latest/plugin_management.html">Plugin Management</a></li><li><a class="nav-link" href="/latest/aws-tools.html">AWS Analytics Tools</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Client Libraries</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/java_client.html">Java</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-ruby" onclick="getOutboundLink('http://github.com/killbill/killbill-client-ruby'); return false;">Ruby</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-php" onclick="getOutboundLink('http://github.com/killbill/killbill-client-php'); return false;">PHP</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-js" onclick="getOutboundLink('http://github.com/killbill/killbill-client-js'); return false;">Node.js</a></li><li><a class="nav-link" href="http://github.com/killbill/killbill-client-python" onclick="getOutboundLink('http://github.com/killbill/killbill-client-python'); return false;">Python</a></li><li><a class="nav-link" href="http://github.com/killbill/kbcli" onclick="getOutboundLink('http://github.com/killbill/kbcli'); return false;">KillBill Go </a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">About Kill Bill</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/demo.html">Demo</a></li><li><a class="nav-link" href="/latest/features.html">Features List</a></li><li><a class="nav-link" href="/latest/faq.html">Technical FAQs</a></li><li><a class="nav-link" href="/latest/Kill-Bill-Glossary.html">Glossary</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">Internal</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="/latest/internal_design.html">Internal Design</a></li><li><a class="nav-link" href="/latest/entitlement_subsystem.html">Entitlement Subsystem</a></li><li><a class="nav-link" href="/latest/invoice_subsystem.html">Invoice Subsystem</a></li><li><a class="nav-link" href="/latest/development.html">Development Environment</a></li></ul></li><li><div class="icon-title"><a class="bd-toc-link main-link" role="button">References</a><svg class="chevron" width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.5024 5.70711C10.1119 6.09763 9.47871 6.09763 9.08818 5.70711L5.7953 2.41421L2.50241 5.70711C2.11188 6.09763 1.47872 6.09763 1.0882 5.70711C0.697672 5.31658 0.697672 4.68342 1.0882 4.29289L5.08819 0.292893C5.47871 -0.0976311 6.11188 -0.0976311 6.5024 0.292893L10.5024 4.29289C10.8929 4.68342 10.8929 5.31658 10.5024 5.70711Z" fill="#D1D5DB"/></svg></div><ul class="nav navbar-nav"><li class="bd-sidenav-active"><a class="nav-link" href="https://github.com/killbill/killbill-docs/tree/v3/swagger" onclick="getOutboundLink('https://github.com/killbill/killbill-docs/tree/v3/swagger'); return false;">Swagger&nbsp;API Schema</a></li><li><a class="nav-link" href="/latest/catalog.xsd">Catalog XSD Reference</a></li><li><a class="nav-link" href="/latest/overdue.xsd">Overdue XSD Reference</a></li></ul></li></ul></nav><script src="https://code.jquery.com/jquery-3.6.1.min.js"></script><script>
  let $ = jQuery;
  $('.sidebar-nav .icon-title').on('click', function (e) {
    e.preventDefault();
    $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
    $('.sidebar-nav > .navbar-nav > li').removeClass('open');

    if($(this).next().is(':visible')){
      $('.sidebar-nav .nav.navbar-nav .nav.navbar-nav').slideUp(200);
      $('.sidebar-nav > .navbar-nav > li').removeClass('open');
    } else {
      $(this).parent().addClass('open');
      $(this).next().slideDown(200);
    }
  });

  let pageURL = $(location).attr("href");
  pageURL = pageURL.includes('.html') ? pageURL : pageURL + '.html';
  $('.nav-link').each(function() {
    if (pageURL.toLowerCase().includes($(this).attr('href').toLowerCase())) {
      $(this).parent().addClass('list-item-active');
      $(this).parent().parent().addClass('active-list');
      $(this).parent().parent().prev().addClass('bd-link-active-wrap');
    }
  });
</script><a class="doclink" href="mailto:support@killbill.io">Report a doc problem</a></aside></div><div class="article-container"><div class="center-content"><div class="main-wrapper"><article class="content-wrapper"><div class="banner"><h1>Kill Bill Database Migrations</h1></div><div id="content"><div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A typical Kill Bill deployment is comprised of several components: The core Kill Bill webapp and some plugins. Migrating the software to a higher version may require to migrate one, a few or all the different components and so potentially upgrading the database schema associated with one, a few or all of those components. The compatibility version between core Kill Bill and its plugins depends on the version of the <a href="https://github.com/killbill/killbill-plugin-api">plugin api</a> exported by a given Kill Bill version. The <a href="https://github.com/killbill/killbill-cloud/tree/master/kpm">KPM</a> tool allows to list compatible plugins associated with a given Kill Bill version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>kpm<span class="tok-w"> </span>info<span class="tok-w"> </span>--version<span class="tok-w"> </span>&lt;killbill_version&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kill Bill and individual plugins assume specific tables, functions, etc. are installed in your database. The source of truth for the schema (DDL) files are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In individual modules for Kill Bill, under <code>*/src/main/resources/org/killbill/billing/*/ddl.sql</code> (for example <a href="https://github.com/killbill/killbill/tree/master/account/src/main/resources/org/killbill/billing/account/ddl.sql">account/src/main/resources/org/killbill/billing/account/ddl.sql</a>).</p>
</li>
<li>
<p>Under <code>src/main/resources/ddl.sql</code> for Java plugins (<a href="https://github.com/killbill/killbill-adyen-plugin/tree/master/src/main/resources/ddl.sql">Adyen example</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These files always contain the latest version, matching the latest code in that specific branch/tag.</p>
</div>
<div class="paragraph">
<p>To access a specific version:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Kill Bill itself, we publish a full DDL file per major version (<a href="https://docs.killbill.io/0.22/ddl.sql">0.22 example</a>). The DDL for the latest stable version of Kill Bill is at <a href="https://docs.killbill.io/latest/ddl.sql">https://docs.killbill.io/latest/ddl.sql</a>.</p>
</li>
<li>
<p>For individual plugins, you can get the DDL file of a given version on GitHub by looking-up the specific tag (for v4.0.2 of the CyberSource plugin, it would be at <a href="https://github.com/killbill/killbill-cybersource-plugin/tree/v4.0.2/db/ddl.sql" class="bare">https://github.com/killbill/killbill-cybersource-plugin/tree/v4.0.2/db/ddl.sql</a>).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migrations_with_docker_images">Migrations with Docker images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>Migrations tooling</code> section below goes into details on how migrations are handled for individual components, and the tooling available to you to update your database schema when upgrading Kill Bill.</p>
</div>
<div class="paragraph">
<p>If you are using our standard Docker images, the procedure is simplified and as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the <code>/var/lib/killbill/kpm.yml</code> file in one of your containers to reflect the new version of Kill Bill you want to upgrade to.</p>
</li>
<li>
<p>Run <code>$MIGRATIONS_CMD</code>. This will:</p>
<div class="ulist">
<ul>
<li>
<p>Configure the database for migrations if needed (i.e. create the <code>schema_version</code> table(s), see below)</p>
</li>
<li>
<p>Fetch all migrations needed to upgrade to the Kill Bill version specified in the <code>kpm.yml</code></p>
</li>
<li>
<p>Display the SQL that would be run (for Kill Bill and each plugin) and prompt the user whether it should be applied</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Depending on your dataset size, you may or may not want the script to apply these directly (e.g. you may prefer to use an online-schema-change tool for production), in which case you can simply grab the SQL output instead.</p>
</div>
<div class="paragraph">
<p>Caveats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This is only supported since <code>killbill/killbill:0.20.10</code></p>
</li>
<li>
<p>Ruby migrations aren&#8217;t supported (if you have any, see the manual steps below)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migrations_tooling">Migrations tooling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to ease the database migrations, we decided to rely on standard tools for migrating from one given version to a higher version:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Java componenents (Kill Bill itself, java plugins), we rely on <a href="https://flywaydb.org/">Flyway</a></p>
</li>
<li>
<p>For Ruby components (KAUI, &#8230;&#8203;), we rely on <a href="http://edgeguides.rubyonrails.org/active_record_migrations.html">Active Record migrations</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to these standard tools, we also enhanced our existing tooling to support the following use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ability to download all the migration files associated with a migration from version <code>N</code> to <code>M</code> (see section <code>KPM</code> below)</p>
</li>
<li>
<p>Ability to output SQL (migration files) for production systems (see section <code>SQL output</code> below)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_kpm">KPM</h3>
<div class="paragraph">
<p>We extended (<a href="https://github.com/killbill/killbill-cloud/tree/master/kpm">KPM</a> with a new <code>migrations</code> verb to be able to <strong>download migration files</strong> that should be applied when migrating from one version to the next.</p>
</div>
<div class="paragraph">
<p>Usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>kpm<span class="tok-w"> </span>migrations<span class="tok-w"> </span>github_repository<span class="tok-w"> </span>from_tag<span class="tok-w"> </span>to_tag</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, to download all migration files for Kill Bill between 0.16.12 and 0.18.0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>kpm migrations killbill killbill-0.16.12 killbill-0.18.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar examples for Java plugins:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>kpm<span class="tok-w"> </span>migrations<span class="tok-w"> </span>killbill-analytics-plugin<span class="tok-w"> </span>analytics-plugin-3.0.0<span class="tok-w"> </span>analytics-plugin-3.0.1
kpm<span class="tok-w"> </span>migrations<span class="tok-w"> </span>killbill-cybersource-plugin<span class="tok-w"> </span>v4.0.1<span class="tok-w"> </span>v4.0.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the implementation relies on the <a href="https://developer.github.com/">GitHub API</a>, unauthenticated requests are subject to <a href="https://developer.github.com/v3/#rate-limiting">rate limiting</a>. To work around it, go to <a href="https://github.com/settings/tokens" class="bare">https://github.com/settings/tokens</a> to generate a token (default public, read-only, permissions will work) and specify it to KPM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>kpm<span class="tok-w"> </span>migrations<span class="tok-w"> </span>killbill<span class="tok-w"> </span>killbill-0.16.3<span class="tok-w"> </span>killbill-0.16.4<span class="tok-w"> </span>--token<span class="tok-o">=</span>TOKEN</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sql_output">SQL output</h3>
<div class="paragraph">
<p>In production environments, database access is often restricted and developers don&#8217;t necessarily have rights to execute DDL commands (i.e. <code>CREATE</code>, <code>ALTER</code>, <code>DROP</code>, etc. statements). To get around this, we provide scripts to get access to the SQL that needs to be run for the migrations, including the <code>INSERT</code> statements to update the metadata table(s).</p>
</div>
<div class="sect3">
<h4 id="_java">Java</h4>
<div class="paragraph">
<p>For Java code (Kill Bill and Java plugins), we publish a <code>killbill-flyway.jar</code> binary which is a wrapper around the <code>flyway</code> utility and exposes a <code>dryRunMigrate</code> command. Simply run it against your production database (read-only credentials are sufficient) to get the raw SQL.</p>
</div>
<div class="paragraph">
<p>Usage example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1"># /var/folders/tmp/migrations is the directory where the migration files were downoaded (using kpm migrate)</span>
java<span class="tok-w"> </span>-jar<span class="tok-w"> </span>killbill-flyway.jar<span class="tok-w"> </span>-locations<span class="tok-o">=</span>filesystem:/var/folders/tmp/migrations<span class="tok-w"> </span>-url<span class="tok-o">=</span><span class="tok-s1">&#39;jdbc:mysql://DATABASE_IP:DATABASE_PORT/DATABASE_NAME&#39;</span><span class="tok-w"> </span>-user<span class="tok-o">=</span>&lt;USERNAME&gt;<span class="tok-w"> </span>-password<span class="tok-o">=</span>&lt;PASSWORD&gt;<span class="tok-w"> </span>dryRunMigrate</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ruby">Ruby</h4>
<div class="paragraph">
<p>For Ruby code, we provide a <code>killbill-migration</code> script with the <code>killbill</code> gem (JRuby is recommended, see our <a href="https://docs.killbill.io/latest/payment_plugin.html#_building_ruby_plugins">installation instructions</a>).</p>
</div>
<div class="paragraph">
<p>Besides outputting the SQL, it can also run the migrations.</p>
</div>
<div class="paragraph">
<p>Usage examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>killbill-migration<span class="tok-w"> </span>current_version<span class="tok-w"> </span>cybersource
killbill-migration<span class="tok-w"> </span>sql_for_migration<span class="tok-w"> </span>cybersource<span class="tok-w"> </span>--path<span class="tok-o">=</span>XXX
killbill-migration<span class="tok-w"> </span>migrate<span class="tok-w"> </span>cybersource<span class="tok-w"> </span>--path<span class="tok-o">=</span>XXX
killbill-migration<span class="tok-w"> </span>ruby_dump<span class="tok-w"> </span>cybersource
killbill-migration<span class="tok-w"> </span>sql_dump<span class="tok-w"> </span>cybersource</code></pre>
</div>
</div>
<div class="paragraph">
<p>Options <code>--username</code>, <code>--password</code>, <code>--database</code> and <code>--host</code> are supported.</p>
</div>
<div class="paragraph">
<p>If you are a plugin developer, these commands are also available as part of the default Rake tasks of the plugin itself, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">PLUGIN_NAME</span><span class="tok-o">=</span>paypal_express<span class="tok-w"> </span><span class="tok-nv">USERNAME</span><span class="tok-o">=</span>root<span class="tok-w"> </span><span class="tok-nv">PASSWORD</span><span class="tok-o">=</span>root<span class="tok-w"> </span><span class="tok-nv">DB</span><span class="tok-o">=</span>killbill<span class="tok-w"> </span>rake<span class="tok-w"> </span>killbill:db:sql_for_migration
<span class="tok-nv">PLUGIN_NAME</span><span class="tok-o">=</span>paypal_express<span class="tok-w"> </span><span class="tok-nv">USERNAME</span><span class="tok-o">=</span>root<span class="tok-w"> </span><span class="tok-nv">PASSWORD</span><span class="tok-o">=</span>root<span class="tok-w"> </span><span class="tok-nv">DB</span><span class="tok-o">=</span>killbill<span class="tok-w"> </span>rake<span class="tok-w"> </span>killbill:db:migrate</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>PLUGIN_NAME</code> variable needs to match the prefix of the <code>schema_migrations</code> table.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kill_bill">Kill Bill</h3>
<div class="paragraph">
<p>Starting with Kill Bill 0.16.4, SQL migrations files for Flyway are provided. They can be found on a per-module basis under <code>*/src/main/resources/org/killbill/billing/*/migration/</code>. The versioning is based on the creation timestamp (i.e. <code>date +'%Y%m%d%H%M%S'</code>) and must be unique for each file so as to indicate the ordering (what Flyway calls the <code>version_rank</code>).</p>
</div>
<div class="sect3">
<h4 id="_baseline">Baseline</h4>
<div class="paragraph">
<p>For Flyway migrations to work correctly, there is an initial <a href="https://flywaydb.org/documentation/command/baseline">baseline</a> operation that needs to happens so as to create the metadata table, called <code>schema_version</code>. In the scenario where a developer can run its own migrations, the following command would be run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>flyway<span class="tok-w"> </span>-url<span class="tok-o">=</span><span class="tok-s1">&#39;jdbc:mysql://DATABASE_IP:DATABASE_PORT/DATABASE_NAME&#39;</span><span class="tok-w"> </span>-user<span class="tok-o">=</span>&lt;USERNAME&gt;<span class="tok-w"> </span>-password<span class="tok-o">=</span>&lt;PASSWORD&gt;<span class="tok-w"> </span>baseline</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the production scenario, the <code>schema_version</code> along with the initial version would have to be created manually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span></span><span class="tok-k">CREATE</span><span class="tok-w"> </span><span class="tok-k">TABLE</span><span class="tok-w"> </span><span class="tok-o">`</span><span class="tok-n">schema_version</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-o">`</span><span class="tok-n">installed_rank</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-nb">int</span><span class="tok-p">(</span><span class="tok-mi">11</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">NOT</span><span class="tok-w"> </span><span class="tok-k">NULL</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-o">`</span><span class="tok-k">version</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">50</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">DEFAULT</span><span class="tok-w"> </span><span class="tok-k">NULL</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-o">`</span><span class="tok-n">description</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">200</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">NOT</span><span class="tok-w"> </span><span class="tok-k">NULL</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-o">`</span><span class="tok-k">type</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">20</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">NOT</span><span class="tok-w"> </span><span class="tok-k">NULL</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-o">`</span><span class="tok-n">script</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">1000</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">NOT</span><span class="tok-w"> </span><span class="tok-k">NULL</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-o">`</span><span class="tok-n">checksum</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-nb">int</span><span class="tok-p">(</span><span class="tok-mi">11</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">DEFAULT</span><span class="tok-w"> </span><span class="tok-k">NULL</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-o">`</span><span class="tok-n">installed_by</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">100</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">NOT</span><span class="tok-w"> </span><span class="tok-k">NULL</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-o">`</span><span class="tok-n">installed_on</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-k">timestamp</span><span class="tok-w"> </span><span class="tok-k">NOT</span><span class="tok-w"> </span><span class="tok-k">NULL</span><span class="tok-w"> </span><span class="tok-k">DEFAULT</span><span class="tok-w"> </span><span class="tok-k">CURRENT_TIMESTAMP</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-o">`</span><span class="tok-n">execution_time</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-nb">int</span><span class="tok-p">(</span><span class="tok-mi">11</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">NOT</span><span class="tok-w"> </span><span class="tok-k">NULL</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-o">`</span><span class="tok-n">success</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-n">tinyint</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">NOT</span><span class="tok-w"> </span><span class="tok-k">NULL</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-k">PRIMARY</span><span class="tok-w"> </span><span class="tok-k">KEY</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">`</span><span class="tok-n">installed_rank</span><span class="tok-o">`</span><span class="tok-p">),</span>
<span class="tok-w">  </span><span class="tok-k">KEY</span><span class="tok-w"> </span><span class="tok-o">`</span><span class="tok-n">schema_version_s_idx</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-o">`</span><span class="tok-n">success</span><span class="tok-o">`</span><span class="tok-p">)</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">ENGINE</span><span class="tok-o">=</span><span class="tok-n">InnoDB</span><span class="tok-w"> </span><span class="tok-k">DEFAULT</span><span class="tok-w"> </span><span class="tok-n">CHARSET</span><span class="tok-o">=</span><span class="tok-n">utf8</span><span class="tok-p">;</span>

<span class="tok-k">insert</span><span class="tok-w"> </span><span class="tok-k">into</span><span class="tok-w"> </span><span class="tok-n">schema_version</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">installed_rank</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-k">version</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">description</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-k">type</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">script</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">installed_by</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">installed_on</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">execution_time</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">success</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">VALUES</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s1">&#39;&lt;&lt; Flyway Baseline &gt;&gt;&#39;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s1">&#39;BASELINE&#39;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s1">&#39;&lt;&lt; Flyway Baseline &gt;&gt;&#39;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s1">&#39;admin&#39;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">NOW</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_migration_from_version_n_to_m">Migration from version <code>N</code> to <code>M</code></h4>
<div class="paragraph">
<p>A typical migration from version <code>N</code> to <code>M</code> will require to first identify the set of migrations files that should be applied and then either apply them using Flyway commands or manually (production use case).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1"># Will download migration files in a temporary folder (e.g /var/folders/XXX)</span>
kpm<span class="tok-w"> </span>migrations<span class="tok-w"> </span>killbill<span class="tok-w"> </span>killbill-N<span class="tok-w"> </span>killbill-M<span class="tok-w"> </span>--token<span class="tok-o">=</span><span class="tok-s1">&#39;GITHUB_TOKEN&#39;</span>

<span class="tok-c1"># If using flyway is an option</span>
flyway<span class="tok-w"> </span>-url<span class="tok-o">=</span><span class="tok-s1">&#39;jdbc:mysql://DATABASE_IP:DATABASE_PORT/DATABASE_NAME&#39;</span><span class="tok-w"> </span>-user<span class="tok-o">=</span>&lt;USERNAME&gt;<span class="tok-w"> </span>-password<span class="tok-o">=</span>&lt;PASSWORD&gt;<span class="tok-w">  </span>-locations<span class="tok-o">=</span>filesystem:/var/folders/XXX<span class="tok-w"> </span>migrate</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java_plugins">Java plugins</h3>
<div class="paragraph">
<p>Java plugins migrations also rely on <a href="https://flywaydb.org/">Flyway</a> and follow a similar workflow than Kill Bill itself. They can be found in each plugin under <code>src/main/resources/migration/</code>.</p>
</div>
<div class="paragraph">
<p>The metadata table should be called <code>&lt;plugin_name&gt;_schema_version</code>. Make sure to specify <code>-table=&lt;plugin_name&gt;_schema_version</code> when invoking Flyway.</p>
</div>
</div>
</div>
</div></div><div class="bottom-nav-links"><a href="#" id="prev-nav-link" class="bottom-nav-link card prev"><span class="arrow-icon left"><svg class="i-arrow" width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.19526 1.02876C4.45561 0.768409 4.87772 0.768409 5.13807 1.02876C5.39842 1.28911 5.39842 1.71122 5.13807 1.97157L2.27614 4.8335H11.3333C11.7015 4.8335 12 5.13197 12 5.50016C12 5.86835 11.7015 6.16683 11.3333 6.16683H2.27614L5.13807 9.02876C5.39842 9.28911 5.39842 9.71122 5.13807 9.97157C4.87772 10.2319 4.45561 10.2319 4.19526 9.97157L0.195261 5.97157C-0.0650883 5.71122 -0.0650883 5.28911 0.195261 5.02876L4.19526 1.02876Z" fill=""/></svg><span class="prev-text">Previous</span></span><span id="prev-navigator" class="bottom-nav-text">Prev</span>                               </a><a href="#" id="next-nav-link" class="bottom-nav-link card next"><span class="arrow-icon"><span class="next-text">Next</span><svg class="i-arrow icon-left" width="12" height="11" viewBox="0 0 12 11" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.19526 1.02876C4.45561 0.768409 4.87772 0.768409 5.13807 1.02876C5.39842 1.28911 5.39842 1.71122 5.13807 1.97157L2.27614 4.8335H11.3333C11.7015 4.8335 12 5.13197 12 5.50016C12 5.86835 11.7015 6.16683 11.3333 6.16683H2.27614L5.13807 9.02876C5.39842 9.28911 5.39842 9.71122 5.13807 9.97157C4.87772 10.2319 4.45561 10.2319 4.19526 9.97157L0.195261 5.97157C-0.0650883 5.71122 -0.0650883 5.28911 0.195261 5.02876L4.19526 1.02876Z" fill=""/></svg></span><span id="next-navigator" class="bottom-nav-text">Next</span></a></div></article></div><div class="bd-links-wrapper"><nav class="bd-links toc right-side-menu" id="myScrollspy" data-toggle="toc"></nav></div></div></div></div></div></main><script src="https://cdn.staticaly.com/gh/afeld/bootstrap-toc/v1.0.0/dist/bootstrap-toc.min.js"></script><script type="module" src="/javascripts/kb.js"></script><script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script><script>docsearch({apiKey: '3ef227e7fd5e2e1a3fffd880484934bf', container: '#docsearch', appId: 'S2ISXITURI', indexName: 'killbill'});</script></body></html>